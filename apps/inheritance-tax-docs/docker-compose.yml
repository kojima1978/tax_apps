# ============================================
# 相続税申告 資料準備ガイド - Docker Compose
# ============================================

# 共通設定
x-common-env: &common-env
  TZ: Asia/Tokyo

x-logging: &default-logging
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"

x-healthcheck-defaults: &healthcheck-defaults
  interval: 30s
  timeout: 60s
  retries: 5
  start_period: 120s

services:
  # ===========================================
  # 相続税申告 資料準備ガイド
  # Port: 3003
  #
  # 機能:
  #   - 相続税申告に必要な書類のリスト管理
  #   - ドラッグ&ドロップで並べ替え
  #   - 書類の編集・追加・削除
  #   - Excel/PDF出力
  #   - JSON形式での設定保存・読込
  # ===========================================
  inheritance-tax-docs:
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    container_name: inheritance-tax-docs-standalone
    ports:
      - "3003:3003"
    volumes:
      # ソースコードをマウント（ホットリロード用）
      - ./src:/app/src:ro
      - ./public:/app/public:ro
    environment:
      <<: *common-env
      NODE_ENV: development
      WATCHPACK_POLLING: "true"
    command: npm run dev -- -p 3003
    restart: unless-stopped
    logging: *default-logging
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:3003/ || exit 1"]
      <<: *healthcheck-defaults
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M
