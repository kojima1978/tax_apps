{% load humanize %}
{% load japanese_date %}

<div class="tab-pane fade" id="large" role="tabpanel" aria-labelledby="large-tab">
    <div class="glass-card p-4">
        {% with tab_name="large" filter_prefix="large" selected_categories=filter_state.large_category selected_mode=filter_state.large_category_mode %}
        {% include "analyzer/partials/_category_filter.html" %}
        {% endwith %}

        <form method="post" id="largeTxForm">
            {% csrf_token %}
            <input type="hidden" name="action" value="bulk_update_categories">
            <input type="hidden" name="source_tab" value="large">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0">å¤šé¡å–å¼•ãƒªã‚¹ãƒˆ {% if filter_state.large_category %}<small class="text-muted">(ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ä¸­)</small>{% endif %}</h4>
                <div>
                    {% if large_txs %}
                    <button type="submit" class="btn btn-primary btn-sm me-2">
                        <i class="bi bi-check-lg"></i> åˆ†é¡ã‚’ä¸€æ‹¬ä¿å­˜
                    </button>
                    <a href="{% url 'export-csv' case.pk 'large' %}" class="btn btn-outline-success btn-sm">
                        <i class="bi bi-download"></i> CSVå‡ºåŠ›
                    </a>
                    {% endif %}
                </div>
            </div>
            {% if large_txs %}
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th>æ—¥ä»˜</th>
                            <th>éŠ€è¡Œå</th>
                            <th>æ”¯åº—å</th>
                            <th>ç¨®åˆ¥</th>
                            <th>å£åº§ç•ªå·</th>
                            <th>æ‘˜è¦</th>
                            <th>æ‰•æˆ»</th>
                            <th>ãŠé ã‚Š</th>
                            <th style="min-width: 130px;">åˆ†é¡</th>
                            <th>æ“ä½œ</th>
                            <th>ğŸ“Œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tx in large_txs %}
                        <tr>
                            <td>{{ tx.date|wareki_short }}</td>
                            <td>{{ tx.bank_name|default:"-" }}</td>
                            <td>{{ tx.branch_name|default:"-" }}</td>
                            <td>{{ tx.account_type|default:"-" }}</td>
                            <td>{{ tx.account_id|default:"-" }}</td>
                            <td>{{ tx.description }}</td>
                            <td class="text-end text-danger fw-bold">{% if tx.amount_out > 0 %}{{ tx.amount_out|intcomma }}{% endif %}</td>
                            <td class="text-end text-success fw-bold">{% if tx.amount_in > 0 %}{{ tx.amount_in|intcomma }}{% endif %}</td>
                            <td>
                                {% with name_prefix="cat-" %}
                                {% include "analyzer/partials/_category_select.html" %}
                                {% endwith %}
                            </td>
                            <td>
                                <div class="d-flex gap-1">
                                    {% include "analyzer/partials/_edit_button.html" %}
                                </div>
                            </td>
                            <td>
                                {% with source_tab="large" %}
                                {% include "analyzer/partials/_flag_button.html" %}
                                {% endwith %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info">è©²å½“ã™ã‚‹å¤šé¡å–å¼•ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¨­å®šç”»é¢ã§é–¾å€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>
            {% endif %}
        </form>
    </div>
</div>
