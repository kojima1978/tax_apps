{% extends 'analyzer/base.html' %}
{% load humanize %}
{% load japanese_date %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-1">
                <li class="breadcrumb-item"><a href="{% url 'case-list' %}"
                        class="text-decoration-none text-muted">æ¡ˆä»¶ä¸€è¦§</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ case.name }}</li>
            </ol>
        </nav>
        <h1 class="h2 mb-0">{{ case.name }}</h1>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'transaction-import' case.pk %}" class="btn btn-primary">
            ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        </a>
        <a href="{% url 'analysis-dashboard' pk=case.pk %}" class="btn btn-secondary">
            ğŸ“Š åˆ†æãƒ»ã‚°ãƒ©ãƒ•
        </a>
    </div>
</div>

<div class="glass-card p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="h5">å–å¼•å±¥æ­´ ({{ total_count }}ä»¶)
            {% if transactions.paginator.num_pages > 1 %}
            <small class="text-muted">({{ transactions.number }} / {{ transactions.paginator.num_pages }}ãƒšãƒ¼ã‚¸)</small>
            {% endif %}
        </h3>
    </div>

    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>æ—¥ä»˜</th>
                    <th>éŠ€è¡Œå</th>
                    <th>æ”¯åº—å</th>
                    <th>å£åº§ç•ªå·</th>
                    <th>æ‘˜è¦</th>
                    <th class="text-end">å‡ºé‡‘</th>
                    <th class="text-end">å…¥é‡‘</th>
                    <th class="text-end">æ®‹é«˜</th>
                    <th>åˆ†é¡</th>
                    <th>æ¨å®š</th>
                </tr>
            </thead>
            <tbody>
                {% for tx in transactions %}
                <tr class="{% if tx.is_large %}table-danger{% endif %}">
                    <td>{{ tx.date|wareki_short }}</td>
                    <td>{{ tx.bank_name|default:"-" }}</td>
                    <td>{{ tx.branch_name|default:"-" }}</td>
                    <td>{{ tx.account_id|default:"-" }}</td>
                    <td>
                        {{ tx.description }}
                        {% if tx.is_transfer %}
                        <span class="badge bg-info text-dark ms-1">è³‡é‡‘ç§»å‹•</span>
                        {% endif %}
                    </td>
                    <td class="text-end text-danger">
                        {% if tx.amount_out > 0 %}{{ tx.amount_out|intcomma }}{% endif %}
                    </td>
                    <td class="text-end text-success">
                        {% if tx.amount_in > 0 %}{{ tx.amount_in|intcomma }}{% endif %}
                    </td>
                    <td class="text-end text-muted">
                        {{ tx.balance|intcomma }}
                    </td>
                    <td>
                        <span class="badge bg-secondary">{{ tx.category|default:"-" }}</span>
                    </td>
                    <td>
                        <small class="text-muted">{{ tx.transfer_to|default:"" }}</small>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="10" class="text-center py-4 text-muted">
                        ã¾ã å–å¼•ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>
                        CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    {% if transactions.paginator.num_pages > 1 %}
    <nav aria-label="å–å¼•å±¥æ­´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³" class="mt-3">
        <ul class="pagination justify-content-center mb-0">
            {% if transactions.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1">&laquo; æœ€åˆ</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ transactions.previous_page_number }}">å‰ã¸</a>
            </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">{{ transactions.number }} / {{ transactions.paginator.num_pages }}</span>
            </li>

            {% if transactions.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ transactions.next_page_number }}">æ¬¡ã¸</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ transactions.paginator.num_pages }}">æœ€å¾Œ &raquo;</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}
